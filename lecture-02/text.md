# Про отладку

Про систему контроля версий: Если вы пользуетесь системой контроля версий, то каждое следует комитить каждое логическое изменение, причём одно за раз.

Чаще давайте свои решения на ревью.

Конспект [конспекта](https://bespoyasov.ru/blog/debug-it/) книги Пола Батчера [Debug it! Find, Repair, and Prevent Bugs in Your Code](https://www.amazon.com/Debug-Repair-Prevent-Pragmatic-Programmers/dp/193435628X)

## Глава 1. Посреди безумия

Отдебажить — это больше, чем «сделать так, чтобы баг исчез». Составляющие эффективного дебагинга:

- понять, почему программа ведёт себя не так, как ожидается;
- исправить ошибку;
- не поломать ничего по дороге;
- не испортить качество кода: читаемость, архитектуру, покрытие тестами и др.;
- принять меры, чтобы подобная проблема не появлялась в будущем.

Не стоит начинать писать заплатку, не разобравшись, что происходит. Это плохо, потому что может поломать то, что работало.

Понять проблему помогают наблюдения. Можно относительно просто провести эксперимент и посмотреть, как работает код.

Дебагинг состоит из 4 этапов:

- _воспроизвести_, найти способ точно и удобно воспроизвести проблему;
- _определить причину_, построить гипотезу проблемы и протестировать её на экспериментах;
- _починить проблему_, не ломая поведение других частей программы;
- _подумать, как предупредить_, что сделать, чтобы не допускать подобных проблем в будущем.

Перед тем, как пробовать воспроизвести проблему, надо определиться, как программа должна работать, и что именно происходит не правильно.

Исправляйть ошибки следует одну за одной, не пытаясь решить несколько проблем за раз. Ошибки могут быть связаны, если чинить всё разом, можно эти связи упустить.

## Глава 2. Воспроизвести

Если проблему нельзя воспроизвести, то её нельзя починить.

Если есть баг‑репорт, повторите шаги оттуда. При этом не забывайте контролировать и сверять

- _версию браузера_,
- _версию ОС_,
- _вводимые данные_ (не забывайте про пограничные значения),
- _версию API_
- _версию вашего приложения_.

Воспроизведение ошибок должно быть не только точным, но и удобным. Поэтому надо убирать лишние шаги, которые не относятся к проблеме. Чем короче путь до проблемы, тем проще её решать.

Есть "плавающие" баги, которые иногда появляются, иногда нет. // TODO

## Глава 3. Определить причину

Когда удалось воспроизвести проблему, нужно заново понять, как именно код работает.

Для этого необходимо строить гипотезы о причинах нежелательного поведения и проводить эксперименты.

Проводить эксперименты лучше в "чистой" ветке, чтобы всегда можно было отследить, что именно вы меняли.

Перед каждым экспериментом лучше понимать, что именно вы пытаетесь проверить, потому что иначе эксперимент бесполезен.

Результат эксперимента может согласовываться с определенной гипотезой (слабое свидетельство в пользу гипотезы), а может опровергать её (сильное свидетельство против гипотезы).

Базовое правило для эксперимента — одно изменение в программе за раз. Множественные изменения могут привести к неправильным выводам.

Не игнорируйте странности. Всё, что вы не понимаете — потенциально баг.

Используйте "бинарный поиск" для определения места, откуда идёт проблема.

Анализируйте, правильную ли часть программы или окружения вы изменяете. Если в результате ничего не меняется, то вы меняете не то, что собирались изменить.

Попробуйте объяснить проблему кому‑то, попробуйте её записать. Отдохните.

## Глава 4. Исправить проблему

Начинайте писать фиксы в чистой ветке.

Перед началом проверьте, что имеющиеся тесты проходят — это нужно для уверенности, что фикс не поломал другую функциональность. Если автотестов нет, то можно их написать или хотя бы представить и зафиксировать план ручного тестирования исправления.

Вам в любом случае нужен тест, который будет падать, демонстрируя проблему, и который будет проходить после исправления, демонстрируя успешность правок.

Исправляйте причину, а не следствия ошибки. Чтобы добраться до причины, надо полностью понять проблему. Если во время объяснения вы произносите нечто вроде «по какой‑то причине» или «не особо ясно, почему здесь так», то до корня проблемы вы ещё не добрались, и фикс не починит её полностью.

Никогда не проводите рефакторинг совместно с фиксом ошибки. Либо вы чините код, либо рефакторите.

## Глава 5. Не допускать такой ошибки в будущем

Примите меры, чтобы подобные ошибки не случались в будущем: проверьте похожие места, напишите тесты.

Проверьте, что решение проблемы соответствует кодстайлу и архитектуре.

git: bisect, rebase, squash, git flow, линтеры, ide, техники дебага
